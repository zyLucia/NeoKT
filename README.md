# Neo KernelTuner - 自适应内核参数自动调节器

## 概述
NeoKernelTuner 是一款智能、零侵入的内核参数优化工具，适用于运行 Linux 内核 4.14 的 64 位 Android 设备。它会根据用户活动、屏幕状态和系统负载自动调整系统参数，以在保持响应速度的同时最大化电池寿命。

## 功能
### ✅ 智能配置文件切换
- **空闲配置文件** - 屏幕关闭时的积极省电模式
- **平衡配置文件** - 日常使用时的性能与电池寿命的最佳平衡
- **高性能配置文件** - 交互任务的最大响应速度
- **游戏配置文件** - 针对高性能应用的低延迟、高吞吐量优化

### ✅ 实时活动检测
- 屏幕状态监控（亮度跟踪）
- 进程计数和工作负载检测
- 内存压力估算（基于 PSI 或 MemAvailable 回退）
- 来自 `/proc/diskstats` 的 I/O 活动跟踪
### ✅ 零用户干预操作
- 自动选择配置，无需用户输入
- 在后台静默调整参数
- 无可见界面，无通知
- 基于使用模式学习配置

### ✅ 全面内核参数优化
优化 `vm.*`、`net.*`、`kernel.*` 和 `fs.*` 参数：
- 内存管理（swappiness、dirty 比例、写回间隔）
- 网络优化（TCP 保活、连接复用）
- I/O 调度（页簇、状态间隔、笔记本模式）
- 文件系统限制（file-max、inotify 监控）
- 进程统计（task_deNeocct、迁移成本）
## 系统要求

- **架构：** 64位 ARM (aarch64/arm64)
- **内核版本：** Linux 4.14 或更高
- **安卓版本：** Android 11
- **权限：** Root 权限 (KSU/Magisk 等)

## 安装

### 方法1：Root 权限
在 Kernel SU、Magisk、Sukisu Ultra 或类似平台上安装

### 方法2：ROM 集成

## 架构

### 配置文件检测逻辑
```
屏幕开启  低负载 → 空闲模式（节省电量）
屏幕开启  中等负载 → 平衡模式
屏幕开启  高负载 → 性能模式
屏幕开启  高负载 高内存 → 游戏模式
屏幕关闭  任意负载 → 空闲模式（最大节省）
```

### 活动指标
- **屏幕状态** - 从亮度文件检测
- **进程数量** - 从 `/proc` 解析
- **内存压力** - PSI avg10 或 MemAvailable/MemTotal 比率
- **I/O 活动** - 从 `/proc/diskstats` 获取已完成读取次数

### 参数应用策略
1. 检测设备特性（内核版本、架构、内存、CPU数量）
2. 以5秒间隔监控用户活动
3. 根据当前工作负载选择最佳配置
4. 应用参数并进行稳定性检查（2次一致读数）
5. 在写入前验证每个参数是否存在
6. 记录详细的成功/失败信息

## 安全功能
✅ **参数验证** - 在写入之前检查每个参数是否存在
✅ **稳定性检测** - 在配置文件更改前等待两次一致读数
✅ **回退处理** - 优雅地处理写入失败
✅ **日志记录** - 提供详细的 logcat 输出以便诊断
✅ **版本检查** - 启动时验证内核版本
✅ **架构检查** - 运行前确保为 64 位架构

## 日志记录
所有事件记录到：
1. **Android Logcat** - `logcat | grep NeoKernelTuner`

## 性能影响

### 电池节省
- 空闲模式：8小时空闲时提升10-20%
- 减少轮询引起的虚拟唤醒
- 优化的内存压力减少GC暂停

### 性能开销
- CPU使用率：<0.5%（5秒轮询间隔）
- 内存使用：约512 KB（最小状态跟踪）
- I/O操作：最小（只读参数检测）

## 故障排除

### 二进制无法启动
```bash
# 检查权限
adb shell ls -l /system/xbin/Neo-kernel-tuner

# 查看日志
adb logcat | grep -E "NeoKernelTuner|kernel|tuner"

# 验证架构
adb shell getconf LONG_BIT  # Should return 64
```

### 参数未生效
```bash
# 检查哪些参数失败
adb logcat | grep "Failed parameters"

# 验证参数是否存在
adb shell cat /proc/sys/vm/swappiness
```

### 内核版本问题
```bash
# 检查内核版本
adb shell uname -r  # Must be 4.19+
```

## 贡献

For 有关问题、改进或优化，请参阅主项目仓库。
